<!doctype html>
<html>
<head>
  <title>Photo Booth</title>
  <link rel=stylesheet type=text/css href="{{ url_for('static', filename='css/style.css') }}">
  <script type="text/javascript" src="{{ url_for('static', filename='js/jquery.min.js') }}" charset="utf-8"></script>
  <script type=text/javascript>
    var $SCRIPT_ROOT = {{ request.script_root|tojson|safe }};
  </script>
  <script type=text/javascript>
    // URL shortener
    // What if this takes an inordinate amount of time?
    // ajax success, jquery deferred
    //http://stackoverflow.com/questions/18502593/jquery-mobile-wait-until-getjson-is-finished
    // done, faily, always
    // http://flask.pocoo.org/docs/patterns/flashing/
    // long-polling
    $(function() {
      function reset() {
        window.location = window.location; 
      }

      $('#take_picture').bind('click', function() {
        $('#take_picture').unbind('click');
        $("#take_picture").remove();

        $("#status-container").html("Taking your picture!</br></br><img src='/static/images/1.gif'/>");

        $.getJSON($SCRIPT_ROOT + '/_take_pictures', function(data) {
          $("#status-container").html('<div>All done!</div><div id="reset">Take some more photos!</div>');

          $('#reset').bind('click', reset);

          for (var i=0, len=data.pictures.length; i < len; i++) {
            $('#pictures').append(
              '<img class="photos" src=' + $SCRIPT_ROOT + '/' + data.pictures[i] + '/>'
            );
          }
        });

        return false;
      
      });
    });
  </script>
</head>
  <body>
    <h1>Take a photo!</h1>
    <div id="take_picture">Take Pictures</div>
    <br/>
    <div id="status-container">&nbsp;</div>
    <br/>
    <div id="pictures"></div>
  </body>
</html>
